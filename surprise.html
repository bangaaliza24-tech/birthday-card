<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Happy Birthday!</title>
<style>
    body {
        text-align: center;
        font-family: 'Segoe UI', sans-serif;
        background: linear-gradient(to bottom, #ffe0f0, #fff6fb);
        padding: 20px;
    }
    h1 {
        color: #ff4da6;
        font-size: 2rem;
        margin-top: 10px;
    }
    .cake {
        position: relative;
        margin: 50px auto;
        width: 220px;
        height: 150px;
        background: #d2691e;
        border-radius: 10px;
        box-shadow: 0 4px 10px rgba(0,0,0,0.2);
    }
    .candle {
        position: absolute;
        width: 15px;
        height: 40px;
        background: #fffacd;
        top: -40px;
        border-radius: 3px;
    }
    .flame {
        position: absolute;
        top: -15px;
        left: 2px;
        width: 10px;
        height: 15px;
        background: radial-gradient(circle, yellow 60%, orange 90%);
        border-radius: 50%;
        animation: flicker 0.2s infinite;
    }
    @keyframes flicker {
        0% { transform: scale(1); opacity: 1; }
        50% { transform: scale(1.1); opacity: 0.8; }
        100% { transform: scale(1); opacity: 1; }
    }
    #message {
        display: none;
        font-size: 1.1rem;
        background: #fff0f5;
        padding: 20px;
        margin: 20px auto;
        max-width: 350px;
        border-radius: 12px;
        box-shadow: 0 0 15px rgba(255,105,180,0.3);
        line-height: 1.5;
        animation: fadeIn 1.5s ease-in-out forwards;
    }
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
    }
    .hint {
        font-size: 0.9rem;
        color: #555;
        margin-top: 5px;
    }
</style>
</head>
<body>

<h1>ðŸŽ‚ Blow Out the Candles! ðŸŽ‚</h1>
<p class="hint">Allow microphone access and blow into it ðŸŽ¤</p>

<div class="cake" id="cake">
    <div class="candle" style="left: 15px;"><div class="flame"></div></div>
    <div class="candle" style="left: 55px;"><div class="flame"></div></div>
    <div class="candle" style="left: 95px;"><div class="flame"></div></div>
    <div class="candle" style="left: 135px;"><div class="flame"></div></div>
    <div class="candle" style="left: 175px;"><div class="flame"></div></div>
</div>

<div id="message">
    ðŸŽ‰ Happy birthday to the <b>bestest friend</b> I have ever met.  
    I wish your birthday to be the best this year from the last 22 years.  
    You might be far but not apart â€” I miss you. ðŸ’–
</div>

<script>
async function startMicDetection() {
    try {
        const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
        const audioContext = new AudioContext();
        const source = audioContext.createMediaStreamSource(stream);
        const analyser = audioContext.createAnalyser();
        analyser.fftSize = 256;
        const dataArray = new Uint8Array(analyser.fftSize);

        source.connect(analyser);

        function detectBlow() {
            analyser.getByteTimeDomainData(dataArray);
            let rms = 0;
            for (let i = 0; i < dataArray.length; i++) {
                let val = (dataArray[i] - 128) / 128;
                rms += val * val;
            }
            rms = Math.sqrt(rms / dataArray.length);

            if (rms > 0.1) { // Blow threshold
                document.querySelectorAll('.flame').forEach(f => f.style.display = 'none');
                document.getElementById('message').style.display = 'block';
            } else {
                requestAnimationFrame(detectBlow);
            }
        }
        detectBlow();
    } catch (err) {
        alert('Microphone access needed to blow out candles.');
    }
}

startMicDetection();
</script>

</body>
</html>
